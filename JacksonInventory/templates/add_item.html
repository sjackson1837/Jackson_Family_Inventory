{% extends 'base.html' %}

{% block title %}
View Inventory
{% endblock %}

{% block content %}

<div class="container">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="category-buttons mb-3">
        <button class="category-button active" onclick="filterItems('all')">All</button>
        {% for category in categories %}
        <button class="category-button" onclick="filterItems('{{ category.name }}')">{{ category.name }}</button>
        {% endfor %}
      </div>
      {% for item in items %}
      <div class="card mb-3{% if item.qty < item.minqty %} text-danger{% endif %} {% if item.category != selectedCategory and selectedCategory != 'all' %}d-none{% endif %}" style="background-color: transparent;">
        <div class="row no-gutters">
          <div class="col-4">
            <a href="{{ url_for('item', id=item.id) }}">
              <img src="{{ item.productimage }}" class="card-img" alt="{{ item.productname }}" style="max-width: 125px; max-height: 125px;">
            </a>
          </div>
          <div class="col-5">
            <div class="card-body">
              <h5 class="card-title">{{ item.productname }}</h5>
              <p class="card-text">{{ item.productcategory }}</p>
            </div>
          </div>
          <div class="col-3">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <p class="card-text{% if item.qty < item.minqty %} text-danger{% endif %}">Qty:</p>
                <p class="card-text text-right">{{ item.qty }}</p>
              </div>
              <div class="d-flex justify-content-between">
                <p class="card-text">Min:</p>
                <p class="card-text text-right">{{ item.minqty }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>


<script>
  var selectedCategory = 'all';

  function filterItems(category) {
    selectedCategory = category;
    var items = document.getElementsByClassName('card');
    for (var i = 0; i < items.length; i++) {
      var item = items[i];
      if (category === 'all' || item.classList.contains(category)) {
        item.classList.remove('d-none');
      } else {
        item.classList.add('d-none');
      }
    }
    updateActiveButton(category);
  }

  function updateActiveButton(category) {
    var buttons = document.getElementsByClassName('category-button');
    for (var i = 0; i < buttons.length; i++) {
      var button = buttons[i];
      if (button.innerText === category) {
        button.classList.add('active');
      } else {
        button.classList.remove('active');
      }
    }
  }
</script>

<style>
  .category-buttons {
    margin-bottom: 10px;
  }

  .category-button {
    margin-right: 5px;
    padding: 5px 10px;
    border: none;
    background-color: #eee;
    cursor: pointer;
  }

  .category-button.active {
    background-color: #ccc;
  }

  .d-none {
    display: none;
  }
</style>

<script>
  // Fetch categories from API endpoint
  fetch('/categories')
    .then(response => response.json())
    .then(data => {
      // Call a function to populate the categories
      populateCategories(data);
    })
    .catch(error => {
      console.error('Error:', error);
    });

  function populateCategories(categories) {
    var categoryButtonsContainer = document.querySelector('.category-buttons');
    categoryButtonsContainer.innerHTML = `
      <button class="category-button active" onclick="filterItems('all')">All</button>
      ${categories.map(category => `
        <button class="category-button" onclick="filterItems('${category.name}')">${category.name}</button>
      `).join('')}
    `;
  }
</script>

{% endblock %}

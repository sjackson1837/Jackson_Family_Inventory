<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Inventory</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .item-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .item-image {
            flex: 1;
            max-width: 400px;
            text-align: center;
        }

        .item-image img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .item-details {
            flex: 2;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .item-details textarea, .item-details input, .item-details select {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .item-details button {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }

        .item-details button:hover {
            background-color: #0056b3;
        }

        .qty-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qty-controls button {
            padding: 0.5rem;
            font-size: 1.2rem;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
        }

        .qty-controls button:hover {
            background-color: #f0f0f0;
        }

        .submit-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .submit-controls a {
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f0f0f0;
            color: black;
            text-decoration: none;
            text-align: center;
        }

        .submit-controls a:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>
<body>

    <div class="container">
        <form action="{{ url_for('update_item', id=item[0]['productid']) }}" method="POST">
            <div class="item-container">
                <div class="item-image">
                    <img src="{{ item[0]['productimage'] }}" alt="Product Image">
                </div>
                <div class="item-details">
                    <textarea id="productname" name="productname" rows="2">{{ item[0]['productname'] }}</textarea>
                    <div class="qty-controls">
                        <span>Qty:</span>
                        <button type="button" onclick="decrementQty()">-</button>
                        <input type="text" id="qty" name="qty" value="{{ item[0]['qty'] }}" required>
                        <button type="button" onclick="incrementQty()">+</button>
                    </div>
                    <div class="qty-controls">
                        <span>Min Qty:</span>
                        <button type="button" onclick="decrementMinQty()">-</button>
                        <input type="text" id="minqty" name="minqty" value="{{ item[0]['minqty'] }}" required>
                        <button type="button" onclick="incrementMinQty()">+</button>
                    </div>
                    <div>
                        <label for="category">Category</label>
                        <select id="category_id" name="category_id" required onchange="updateSubcategories()">
                            {% for category in categories %}
                            <option value="{{ category.id }}" {% if category.id == item[0]['categoryid'] %}selected{% endif %}>{{ category.category }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="subcategory">Sub Category</label>
                        <select id="subcategory" name="subcategory_id" required>
                            {% for subcategory in subcategories %}
                            <option value="{{ item[0]['subcategoryid'] }}" {% if subcategory.id==item[0]['subcategoryid'] %}selected{% endif %}>{{ subcategory.subcategory }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="submit-controls">
                        <input type="submit" value="Update Item">
                        <a href="{{ url_for('items_page') }}">Cancel</a>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        function incrementQty() {
            const qtyInput = document.getElementById('qty');
            let qtyValue = parseInt(qtyInput.value);
            qtyValue = isNaN(qtyValue) ? 0 : qtyValue;
            qtyInput.value = qtyValue + 1;
        }

        function decrementQty() {
            const qtyInput = document.getElementById('qty');
            let qtyValue = parseInt(qtyInput.value);
            qtyValue = isNaN(qtyValue) ? 0 : qtyValue;
            qtyInput.value = qtyValue > 0 ? qtyValue - 1 : 0;
        }

        function incrementMinQty() {
            const qtyInput = document.getElementById('minqty');
            let qtyValue = parseInt(qtyInput.value);
            qtyValue = isNaN(qtyValue) ? 0 : qtyValue;
            qtyInput.value = qtyValue + 1;
        }

        function decrementMinQty() {
            const qtyInput = document.getElementById('minqty');
            let qtyValue = parseInt(qtyInput.value);
            qtyValue = isNaN(qtyValue) ? 0 : qtyValue;
            qtyInput.value = qtyValue > 0 ? qtyValue - 1 : 0;
        }

        function updateSubcategories() {
            var category_id = document.getElementById('category_id').value;
            var subcategoryDropdown = document.getElementById('subcategory');

            // Clear previous options
            subcategoryDropdown.innerHTML = '';

            // Create an empty default option
            var defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '-- Select Subcategory --';
            subcategoryDropdown.appendChild(defaultOption);

            // Perform an AJAX request to retrieve subcategories based on the selected category
            if (category_id !== '') {
                $.ajax({
                    url: '/subcategories',
                    method: 'POST',
                    data: {
                        category_id: category_id
                    },
                    success: function (response) {
                        // Add new subcategory options based on the server response
                        response.subcategories.forEach(function (subcategory) {
                            var option = document.createElement('option');
                            option.value = subcategory.id;
                            option.textContent = subcategory.name;
                            subcategoryDropdown.appendChild(option);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            }
        }
    </script>

</body>
</html>
